# üîß Guide G√©n√©ration ‚Äî Template

*(Domaine de g√©n√©ration : **${domain}** ‚Äî ai-orchestrator-v4)*

---

## 1. üéØ Objectif du domaine de g√©n√©ration

Le guide de g√©n√©ration **${domain}** d√©crit comment g√©n√©rer du **code source ex√©cutable** dans la stack cible √† partir :

1. Des **mappings Phase 2** (`mapping.*.json`) qui d√©crivent la projection Legacy ‚Üí Stack cible.
2. De la **structure du projet cible** (`project-structure.json`) qui d√©finit l'arborescence, les conventions de nommage.
3. Des **stack guides Phase 0** (`guide.*.md`) qui d√©finissent les patterns, conventions, et best practices de la stack cible.
4. Du **bridge Legacy ‚Üí DSL** (`bridge-legacy-to-dsl.json`) pour les transformations de patterns.

Il r√©pond √† la question :

> **"Comment transformer les mappings abstraits en fichiers de code concrets, idiomatiques, et fonctionnels dans la stack cible ?"**

Le domaine G√©n√©ration **${domain}** :

- **lit** les mappings pertinents (jamais le Legacy directement),
- **g√©n√®re** du code TypeScript/JavaScript/CSS respectant les conventions de la stack,
- **respecte** les d√©pendances techniques (types avant composants, services avant hooks, etc.),
- **produit** des fichiers ex√©cutables, testables, et maintenables.

Il **ne fait pas** :

- de nouvelle analyse du Legacy (cela appartient √† Phase 1),
- de nouvelle interpr√©tation des concepts DSL (cela appartient √† Phase 2),
- de validation fonctionnelle (cela appartient √† Phase 4).

---

## 2. üì¶ Format de sortie attendu

### 2.1. Artefacts g√©n√©r√©s

Le guide de g√©n√©ration **${domain}** produit un ou plusieurs fichiers dans :

```
${paths.workspace}/projects/${project.name}/pages/${project.pageName}/phase-3-generation/src_new/
```

Respectant la structure d√©finie dans `project-structure.json` :

- **Types** : `src/types/*.types.ts`
- **Services** : `src/services/*.service.ts`
- **Stores** : `src/stores/*.store.ts`
- **Hooks** : `src/pages/${pageName}/hooks/*.ts`
- **Composants** : `src/pages/${pageName}/components/*.tsx`
- **Pages** : `src/pages/${pageName}/${PageName}Page.tsx`
- **Routes** : `src/routes/*.routes.tsx`
- **i18n** : `src/locales/${lang}/*.json`
- **Tests** : `src/**/__tests__/*.test.ts(x)`

### 2.2. Conventions de nommage

D√©finies dans `project-structure.json` :

- **Composants** : `PascalCase` (ex : `CampaignCard.tsx`)
- **Hooks** : `useCamelCase` (ex : `useCampaigns.ts`)
- **Services** : `camelCase.service.ts` (ex : `campaigns.service.ts`)
- **Fichiers** : `kebab-case` pour les non-composants (ex : `campaign-utils.ts`)
- **Types** : `PascalCase` avec suffix `.types.ts` (ex : `Campaign.types.ts`)

### 2.3. Tra√ßabilit√© UCR

Chaque fichier g√©n√©r√© **doit contenir** un commentaire de tra√ßabilit√© reliant le code aux UCR sources :

```typescript
/**
 * Generated by ai-orchestrator-v4 - Phase 3
 * 
 * UCR Mapping: map-structure-CampaignsDetail-list
 * Source Inventory: inventory.structure.json (view-CampaignsDetail-list)
 * Stack Guide: guide.ui-components.md
 * 
 * @generated 2025-12-07
 */
```

---

## 3. üß† R√®gles de g√©n√©ration ‚Äî Niveau g√©n√©rique

### 3.1. Concepts DSL utilis√©s

Le domaine **${domain}** utilise principalement les concepts DSL suivants :

_(Liste des concepts DSL pertinents pour ce domaine, ex : `structure.*`, `logic.*`, `dataflows.*`)_

Exemples :
- `structure.component` ‚Üí G√©n√©ration de composants React
- `logic.businessRule` ‚Üí G√©n√©ration de hooks m√©tier
- `dataflows.query` ‚Üí G√©n√©ration de hooks React Query
- `services.apiEndpoint` ‚Üí G√©n√©ration d'API clients

### 3.2. Inputs principaux

Pour chaque √©l√©ment √† g√©n√©rer, le guide doit consulter :

1. **Mappings Phase 2** (obligatoires)
   - `mapping.${domain}.json` (mapping principal)
   - `mapping.structure.json` (contexte structurel)
   - Autres mappings li√©s via `relations.${domain}Ucrs`

2. **Structure cible** (obligatoire)
   - `project-structure.json` ‚Üí chemins, conventions, r√®gles

3. **Stack guides** (obligatoires)
   - `guide.structure.md`
   - `guide.ui-components.md`
   - `guide.state-management.md`
   - `guide.api-client.md`
   - etc. (selon le domaine)

4. **Bridge Legacy ‚Üí DSL** (optionnel)
   - `bridge-legacy-to-dsl.json` ‚Üí transformations de patterns

### 3.3. Strat√©gie de g√©n√©ration

#### √âtape 1 : R√©solution des d√©pendances

Avant de g√©n√©rer un fichier, v√©rifier que :
- Les **types** n√©cessaires sont d√©j√† g√©n√©r√©s (Stage 50)
- Les **services** requis existent (Stage 51)
- Les **hooks** d√©pendants sont disponibles (Stages 53-54)
- Les **composants** parents sont g√©n√©r√©s (Stage 55 avant 56)

**Graphe de d√©pendances recommand√©** :
```
Types (50) ‚Üí Services (51) ‚Üí Stores (52)
                          ‚Üì
                    Hooks Logic (53)
                          ‚Üì
                    Hooks Data (54)
                          ‚Üì
                    Components Atoms (55)
                          ‚Üì
                    Components Containers (56)
                          ‚Üì
                    Pages (57) ‚Üí Routing (58)
                          ‚Üì
                    Tests (60)
```

#### √âtape 2 : Extraction des informations du mapping

Pour chaque `MappingItem` de `mapping.${domain}.json` :

```typescript
// Lire le mapping item
const mappingItem = getMappingItem(ucr);

// Extraire les m√©tadonn√©es de g√©n√©ration
const {
  toStack: {
    stackKind,      // Type d'artefact √† g√©n√©rer
    targetId,       // Nom de l'artefact
    targetPath,     // Chemin exact du fichier
    targetLayer,    // Couche (presentation, logic, data, etc.)
    targetPattern,  // Pattern √† utiliser (custom hook, HOC, render props, etc.)
    hints           // Indices suppl√©mentaires
  },
  relations       // UCRs li√©s (structure, logic, events, etc.)
} = mappingItem;
```

#### √âtape 3 : Consultation des stack guides

Identifier les patterns √† appliquer depuis les stack guides :

```typescript
// Exemple : G√©n√©ration d'un composant React
const componentPattern = getPatternFromGuide('guide.ui-components.md', {
  stackKind: 'component',
  layer: 'presentation',
  style: 'functional'
});

// Exemple : G√©n√©ration d'un hook React Query
const queryHookPattern = getPatternFromGuide('guide.api-client.md', {
  stackKind: 'dataHook',
  queryType: 'query',
  cacheStrategy: 'staleWhileRevalidate'
});
```

#### √âtape 4 : G√©n√©ration du code

Appliquer le pattern avec les donn√©es du mapping :

```typescript
// G√©n√©rer le code √† partir du pattern et des donn√©es
const generatedCode = applyPattern(componentPattern, {
  name: targetId,
  props: extractPropsFromRelations(relations),
  hooks: extractHooksFromRelations(relations),
  events: extractEventsFromRelations(relations),
  style: extractStyleFromMapping(mappingItem)
});

// Ajouter les imports n√©cessaires
const importsCode = resolveImports(generatedCode, relations);

// Ajouter la tra√ßabilit√© UCR
const traceabilityComment = generateTraceabilityComment(ucr, mappingItem);

// Assembler le fichier final
const finalCode = [
  traceabilityComment,
  importsCode,
  generatedCode
].join('\n\n');
```

#### √âtape 5 : √âcriture du fichier

Respecter la structure et les conventions :

```typescript
// R√©soudre le chemin complet
const fullPath = resolveTargetPath(targetPath);

// Cr√©er les dossiers n√©cessaires
await createDirectories(path.dirname(fullPath));

// √âcrire le fichier
await writeFile(fullPath, finalCode, 'utf-8');

// Formatter avec Prettier (si configur√©)
await formatFile(fullPath);
```

---

## 4. üé® Patterns sp√©cifiques au domaine **${domain}**

_(√Ä compl√©ter selon le domaine sp√©cifique)_

### 4.1. Pattern : [Nom du pattern 1]

**Quand utiliser ce pattern :**
- Condition 1
- Condition 2

**Exemple de mapping :**
```json
{
  "ucr": "map-${domain}-example",
  "toStack": {
    "stackKind": "...",
    "targetPattern": "..."
  }
}
```

**Code g√©n√©r√© :**
```typescript
// Exemple de code g√©n√©r√© pour ce pattern
```

### 4.2. Pattern : [Nom du pattern 2]

_(R√©p√©ter pour chaque pattern sp√©cifique au domaine)_

---

## 5. üîó Relations avec autres domaines

### 5.1. D√©pendances amont (inputs)

Le domaine **${domain}** d√©pend de :

- **Domaine X** : Description de la d√©pendance
- **Domaine Y** : Description de la d√©pendance

### 5.2. D√©pendances avales (outputs utilis√©s par)

Les artefacts g√©n√©r√©s par **${domain}** sont utilis√©s par :

- **Domaine Z** : Description de l'utilisation
- **Tests** : Description de l'utilisation dans les tests

---

## 6. ‚úÖ Validation et auto-checks

### 6.1. Checks √† l'entr√©e (Pre-generation)

Avant de g√©n√©rer, v√©rifier :

- [ ] Tous les mappings requis sont disponibles
- [ ] Les d√©pendances techniques sont satisfaites (types, services, hooks‚Ä¶)
- [ ] Les stack guides pertinents sont lisibles
- [ ] La structure cible est valide (`project-structure.json`)
- [ ] Aucune collision de noms de fichiers d√©tect√©e

### 6.2. Checks √† la sortie (Post-generation)

Apr√®s g√©n√©ration, v√©rifier :

- [ ] Tous les fichiers ont √©t√© cr√©√©s aux bons chemins
- [ ] Le code g√©n√©r√© respecte les conventions de nommage
- [ ] Les imports sont r√©solvables (pas d'imports cass√©s)
- [ ] Les commentaires de tra√ßabilit√© UCR sont pr√©sents
- [ ] Le code compile sans erreur TypeScript (si applicable)
- [ ] Le formatting Prettier est appliqu√© (si configur√©)

### 6.3. R√©sum√© JSON de g√©n√©ration

Chaque stage de g√©n√©ration doit produire un r√©sum√© :

```json
{
  "domain": "${domain}",
  "stageId": "${stageId}",
  "pageName": "${project.pageName}",
  "generation": {
    "filesGenerated": 12,
    "filesUpdated": 3,
    "filesSkipped": 0,
    "errors": []
  },
  "checks": {
    "inputsAvailable": true,
    "dependenciesSatisfied": true,
    "outputsWritten": true,
    "codeCompiles": true
  }
}
```

Ce r√©sum√© est **affich√©** dans la r√©ponse de l'IA, **pas √©crit sur disque** (sauf pour le stage summary final).

---

## 7. üö® Gestion des erreurs

### 7.1. Erreurs bloquantes (Gate ‚ùå)

Les situations suivantes doivent d√©clencher un `Gate ‚ùå` :

- **Mapping manquant** : Un UCR r√©f√©renc√© dans `relations` n'existe pas
- **D√©pendance manquante** : Un type/service/hook requis n'a pas √©t√© g√©n√©r√©
- **Collision de fichiers** : Deux mappings pointent vers le m√™me `targetPath`
- **Stack guide introuvable** : Un guide requis n'existe pas
- **Structure cible invalide** : `project-structure.json` est malform√© ou incomplet
- **Erreur TypeScript** : Le code g√©n√©r√© ne compile pas (si validation activ√©e)

### 7.2. Avertissements (non-bloquants)

Les situations suivantes g√©n√®rent un **warning** mais ne bloquent pas :

- **Pattern non trouv√©** : Utilisation d'un pattern par d√©faut
- **Relation optionnelle manquante** : UCR li√© absent mais non critique
- **M√©tadonn√©e manquante** : Information optionnelle absente
- **Formatting √©chou√©** : Prettier a √©chou√© mais le fichier est √©crit

---

## 8. üìö Exemples complets

### 8.1. Exemple minimal

_(Exemple complet de g√©n√©ration pour ce domaine)_

**Mapping input :**
```json
{
  "ucr": "map-${domain}-example",
  "fromDsl": "${dslConcept}",
  "toStack": {
    "stackKind": "...",
    "targetId": "Example",
    "targetPath": "src/..."
  }
}
```

**Code g√©n√©r√© :**
```typescript
// Code g√©n√©r√©
```

### 8.2. Exemple avanc√©

_(Exemple avec relations complexes, multiples d√©pendances)_

---

## 9. üîÑ √âvolution et maintenance

### 9.1. Ajout d'un nouveau pattern

Pour ajouter un nouveau pattern de g√©n√©ration :

1. Documenter le pattern dans la section 4 de ce guide
2. Ajouter le pattern au stack guide correspondant
3. Mettre √† jour les exemples
4. Ajouter des tests de g√©n√©ration

### 9.2. Modification d'un pattern existant

Pour modifier un pattern :

1. Documenter la raison du changement
2. Mettre √† jour les exemples
3. V√©rifier la compatibilit√© avec les mappings existants
4. Tester la r√©g√©n√©ration

---

## 10. üìñ R√©f√©rences

### 10.1. Guides li√©s

- `guide.ucr.md` ‚Äî R√®gles de nommage UCR
- `guide.json-schema-validation.md` ‚Äî Validation JSON
- `core/templates/stage-markdown.template.md` ‚Äî Template de stage
- Stack guides Phase 0 (selon le domaine)

### 10.2. Sch√©mas JSON

- `core/schemas/mapping.${domain}.schema.json` (si existe)
- `core/schemas/project-structure.schema.json`

---

¬© 2025 Sylvain Chabaud ‚Äî ai-orchestrator-v4
